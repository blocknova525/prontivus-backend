services:
  - type: web
    name: prontivus-backend-2 # This MUST match your Render web service name
    env: python
    plan: free
    # Since your backend files are at the root of the repository,
    # you do not need to specify a 'rootDir' here.
    buildCommand: bash -c "poetry install --only main --no-root && pip install psutil && pip install PyJWT"
    startCommand: poetry run uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.8  # This will explicitly tell Render to use Python 3.11.8
      # Using Render's auto-generated PG* environment variables from Private Service Connection
      - key: DATABASE_URL
        value: postgresql://${PGUSER}:${PGPASSWORD}@${PGHOST}:${PGPORT}/${PGDATABASE}
      - key: DATABASE_URL_ASYNC
        value: postgresql+asyncpg://${PGUSER}:${PGPASSWORD}@${PGHOST}:${PGPORT}/${PGDATABASE}
      - key: POSTGRES_USER
        value: ${PGUSER}
      - key: POSTGRES_PASSWORD
        value: ${PGPASSWORD}
      - key: POSTGRES_HOST
        value: ${PGHOST}
      - key: POSTGRES_PORT
        value: ${PGPORT}
      - key: POSTGRES_DB
        value: ${PGDATABASE}
      # Application Settings
      - key: USE_DATABASE
        value: "true"
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false" 